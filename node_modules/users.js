/*
 * Back end functions for anything related to users
 */

var dbAccess = require('dbAccess');

// Returns the userid of given username, or -1 if no user exists by that username
var getIdFromUsername = exports.getIdFromUsername = function(username, callback) {
	// TODO: Make this check the username instead of real name once that is implemented
	var q = "SELECT id FROM users WHERE name = '" + username + "';";
	util.log(q);
	dbAccess.runQuery(q, function(error, results) {
		if (error) {
			util.log('Error running query in users.getIdFromUsername. ' + error);
			if (callback instanceof Function) callback(error);
		}
		else if (results.length != 1) {
			var error = "Error in users.getIdFromUser.";
			util.log(error);
			if (callback instanceof Function) callback(error);
		}
		else {
			if (callback instanceof Function) callback(undefined, results[0].id);
		}
	});
}

var getUsernameFromId = exports.getUsernameFromId = function(userid, callback) {
	// TODO: Make this get the username instead of real name once that is implemented
	var q = "SELECT name FROM users WHERE id = '" + userid + "';";
	dbAccess.runQuery(q, function(error, results) {
		if(error) {
			util.log("Error finding username from userid." + error);
			if (callback instanceof Function) callback(error);
		}
		else if (results.length != 1) {
			var error = "Error in users.getUsernameFromId. " + q;
			util.log(error);
			if (callback instanceof Function) callback(error);
		}
		else
			if (callback instanceof Function) callback(undefined, results[0].name);
	});
}